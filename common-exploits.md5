# How to find common exploits


### Timthumb

Older versions of TimThumb have a major exploit in them, and in the last 3 weeks I have found 6-8 different out-dated versions of TimThumb used in various WordPress themes or plug-ins.

The exploit, basically allows you to run Linux commands on the server, which allows uploading a WebShell Kit or many other random things.

Since the company I work for, has approx 400-800 websites spread across 2-4 different dedicated servers, I needed a way to search the entire directory structure of each server.   I logged in via SSH as root and used the following commands to search for timthumb.php and thumb.php


```bash

	# these commands will list the absolute server path to timthumb.php and thumb.php
	find *  -iname 'timthumb*' -ls
	find *  -iname 'thumb.php' -ls

```

Once you find the files, make sure you either remove any use of TimThumb ( wordpress has a very nice feature to resize images ) or replace [TimThumb](http://timthumb.googlecode.com/svn/trunk/timthumb.php) with the latest version.

There is also a WordPress plug-in to verify your WordPress install does not include the exploitable timthumb.php

 - [TimThumb Vulnerability Scanner](http://wordpress.org/extend/plugins/timthumb-vulnerability-scanner/)


### Finding Encoded Malware

Another exploit is to encrypt malicious code and EVAL it, another shell command I use to search for encrypted code in my PHP files is


```bash

	# Search a directory
	grep -r base64_decode *

	# Search entire server
	grep -r --exclude={wp-app.php,class-simplepie.php,class-IXR.php} base64_decode *

```

Any files found using this method, will have to be inspected and probably re-built.


### Cleaning up a Hacked Wordpress

If your Wordpress has been Hacked and you need to clean it up, you will need to re-install everything from scratch.

My personal workflow for cleaning up a hacked workpress is this, on my local development env,  I create a new virtual host, and start with a brand new WordPress install.

 - Install a clean [wordpress](http://codex.wordpress.org/Installing_WordPress) install
 - Download **all** plug-ins fresh, **DO NOT USE THE EXISTING PLUGINS**
 - Back a database backup of the hacked version of WordPress
 - Change the default table prefix from **wp_** to something very random
 - Change the default admin username from **admin** to something harder to guess.


**PRO-TIP** DO NOT EVER DO A FIND/REPLACE on a WordPress Database SQL file, most of the data is serialized so you will need the
[Search and Replace](https://interconnectit.com/products/search-and-replace-for-wordpress-databases) tool.













